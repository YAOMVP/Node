<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="./lib/bootstrap.css">
    <script src="./lib/jquery.js"></script>
    <style>
        .w {
            width: 80%;
            margin: 0 auto;
        }
    </style>
</head>

<body>
    <div class="w">
        <!-- bs3-panel:danger -->
        <div class="panel panel-danger">
            <div class="panel-heading">
                <h3 class="panel-title">æ·»åŠ å›¾ä¹¦</h3>
            </div>
            <div class="panel-body form-inline">
                <!-- bs3input-group:addon -->
                <div class="input-group">
                    <div class="input-group-addon">ä¹¦å</div>
                    <input type="text" class="form-control" id="bookname" placeholder="è¯·è¾“å…¥ä¹¦å" />
                </div>
                <div class="input-group">
                    <div class="input-group-addon">ä½œè€…</div>
                    <input type="text" class="form-control" id="author" placeholder="è¯·è¾“å…¥ä½œè€…" />
                </div>
                <div class="input-group">
                    <div class="input-group-addon">å‡ºç‰ˆç¤¾</div>
                    <input type="text" class="form-control" id="publisher" placeholder="è¯·è¾“å…¥å‡ºç‰ˆç¤¾" />
                </div>
                <button id="btnAdd" class="btn btn-danger">æ·»åŠ </button>
            </div>
        </div>
        <table class="table table-bordered table-hover">
            <thead>
                <tr>
                    <th>Id</th>
                    <th>ä¹¦å</th>
                    <th>ä½œè€…</th>
                    <th>å‡ºç‰ˆç¤¾</th>
                    <th>æ“ä½œ</th>
                </tr>
            </thead>
            <tbody id="tb">
                <!-- <tr>
                    <td>id</td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td>
                        <a href="javascript:void(0);">åˆ é™¤</a>
                </td>
                </tr> -->
            </tbody>
        </table>
    </div>
    <script>
        //1.ğŸ˜Šè·å¾—å›¾ä¹¦ä¿¡æ¯ å¯ä»¥å°è£…å‡½æ•°ï¼Œå› ä¸ºè€ç”¨
        $(function() {
            function getBooks() {
                $.ajax({
                    type: "get",
                    url: "http://www.liulongbin.top:3006/api/getbooks",
                    success: function(backData) {
                        console.log(backData); //ğŸ˜Šdataæ˜¯æ•°ç»„æ ¼å¼ éœ€è¦å¾ªç¯
                        if (backData.status === 200) {
                            let data = backData.data;
                            htmlStr = "";
                            $.each(data, function(index, value) {
                                //ğŸ˜Šè¿·çªï¼ï¼ï¼ğŸ˜Š ä¸»è¦htmlStrå†™çš„ä½ç½®ï¼š
                                htmlStr += `
                                <tr>
                                    <td>${value.id}</td>
                                    <td>${value.bookname}</td>
                                    <td>${value.author}</td>
                                    <td>${value.publisher}</td>
                                    <td><a dataid ="${value.id}" href="javascript:void(0);">åˆ é™¤</a></td>
                                </tr> 
                                `
                            })
                            $("#tb").html(htmlStr);
                        }
                    }
                })
            }
            getBooks();

            //2.ç‚¹å‡»æ·»åŠ æŒ‰é’®ï¼Œæ·»åŠ å›¾ä¹¦ä¿¡æ¯
            $("#btnAdd").on("click", function() {
                let bookName = $("#bookname").val().trim();
                let bookAuthor = $("#author").val().trim();
                let bookPublisher = $("#publisher").val().trim();
                //ğŸ˜Šåˆ«å¿˜äº†åšä¸€ä¸ªåˆ¤æ–­
                if (bookName === "" || bookAuthor === "" || bookPublisher === "") {
                    return "";
                }
                $.ajax({
                    type: "post",
                    url: "http://www.liulongbin.top:3006/api/addbook",
                    data: {
                        bookname: bookName,
                        author: bookAuthor,
                        publisher: bookPublisher
                    },
                    success: function(backData) {
                        console.log(backData);
                        //ğŸ˜Š3.å¯ä»¥åšä¸ªåˆ¤æ–­
                        if (backData.status === 201) {
                            getBooks();
                        }
                    }
                })
            })

            //ğŸ˜Šï¼ï¼ï¼3.åˆ é™¤æ“ä½œ  å› ä¸ºæœ‰çš„aæ ‡ç­¾åˆ é™¤æ—¶3æœ¬æ•°ä¸€ä¸Šæ¥å°±æœ‰ï¼Œæœ‰çš„aæ ‡ç­¾æ—¶åŠ¨æ€æ·»åŠ çš„ï¼Œæ‰€ä»¥å¯ä»¥åˆ©ç”¨äº‹ä»¶å§”æ‰˜ï¼Œç‚¹å‡»çˆ¶äº²ulï¼Œå°±å¯ä»¥åˆ é™¤li
            $("#tb").on("click", "a", function() { //IğŸ˜Šè¿™ä¸ªæ˜¯ç”¨çš„äº‹ä»¶å§”æ‰˜ï¼Œ$("#tb").on("click", "a",è¿›è¡Œæ“åšï¼ŒğŸ˜Šæ˜¯ağŸ˜Šæ˜¯ağŸ˜Šæ˜¯a
                //IğŸ˜ŠğŸ˜ŠğŸ˜ŠğŸ˜ŠğŸ˜ŠğŸ˜Šå¯ä»¥æŠŠdataidç›´æ¥å­˜åœ¨aé‡Œè¾¹ï¼Œaæ˜¯ä¸€ä¸ªæ ‡ç­¾å¯ä»¥æ·»åŠ è‡ªå®šä¹‰å±æ€§
                let dataid = $(this).attr("dataid"); //this æŒ‡çš„æ˜¯aï¼ŒğŸ˜Šåˆ«å¿˜äº†æ˜¯äº‹ä»¶å§”æ‰˜ï¼Œ $("#tb").on("click", "a",è¿›è¡Œæ“åšï¼ŒğŸ˜Šæ˜¯ağŸ˜Šæ˜¯ağŸ˜Šæ˜¯aï¼Œç„¶åaé‡Œè¾¹æœ‰ä¸ªattrè‡ªå®šä¹‰å±æ€§
                // æˆ–è€…è¿™ä¹ˆå†™ï¼š
                //let dataid = $(this).parents("tr").children[0].text();
                console.log(this);
                $.ajax({
                    type: "get",
                    url: "http://www.liulongbin.top:3006/api/delbook",
                    data: {
                        id: dataid
                    },
                    success: function(backData) {
                        console.log(backData);
                        if (backData.status === 200) {
                            alert("Delete successfully");
                            getBooks();
                        }
                    }
                })
            })
        })
    </script>

</body>

</html>