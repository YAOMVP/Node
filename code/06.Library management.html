<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="./lib/bootstrap.css">
    <script src="./lib/jquery.js"></script>
</head>


<body style="padding: 15px;">
    <!-- æ·»åŠ å›¾ä¹¦çš„panelé¢æ¿-->

    <div class="panel panel-primary">
        <div class="panel-heading">
            <h3 class="panel-title">æ·»åŠ æ–°å›¾ä¹¦</h3>
        </div>
        <div class="panel-body form-inline">

            <div class="input-group">
                <div class="input-group-addon">ä¹¦å</div>
                <input type="text" class="form-control" id="iptBookname" placeholder="è¯·è¾“å…¥ä¹¦å">
            </div>
            <div class="input-group">
                <div class="input-group-addon">ä½œè€…</div>
                <input type="text" class="form-control" id="iptAuthor" placeholder="è¯·è¾“å…¥ä½œè€…">
            </div>
            <div class="input-group">
                <div class="input-group-addon">å‡ºç‰ˆç¤¾</div>
                <input type="text" class="form-control" id="iptPublisher" placeholder="è¯·è¾“å…¥å‡ºç‰ˆç¤¾">
            </div>

            <button id="btnAdd" class="btn btn-primary">æ·»åŠ </button>

        </div>
    </div>


    <!-- æ·»åŠ å›¾ä¹¦çš„è¡¨æ ¼-->

    <table class="table table-bordered table-hover">
        <thead>
            <tr>
                <th>ID</th>
                <th>ä¹¦å</th>
                <th>ä½œè€…</th>
                <th>å‡ºç‰ˆç¤¾</th>
                <th>æ“ä½œ</th>
            </tr>
        </thead>
        <tbody id="tb">

        </tbody>
    </table>

    <script>
        //ğŸ˜Šè·å–å›¾ä¹¦åˆ—è¡¨çš„æ•°æ®
        //å…ˆè°ƒç”¨jqueryå…¥å£å‡½æ•° $(function(){})
        $(function() {
            //å®šä¹‰ä¸€ä¸ªæ–¹æ³•getBookListï¼Œè·å–å›¾ä¹¦åˆ—è¡¨çš„æ•°æ®,å‘èµ·GETè¯·æ±‚ $.get(url,function(res){})
            function getBookList() {
                $.get('http://www.liulongbin.top:3006/api/getbooks', function(res) {
                    //æœåŠ¡å™¨å“åº”å›æ¥çš„æ•°æ®ä¸­çš„çŠ¶æ€ç 
                    if (res.status !== 200) {
                        return alert('å¤±è´¥äº†å‘¢')
                    }

                    //ğŸ˜Šæ¸²æŸ“å›¾ä¹¦åˆ—è¡¨ï¼Œå°±æ˜¯æŠŠå·²æœ‰çš„ä¹¦æ·»åŠ è¿›å»
                    //å­˜å‚¨ä¸€ä¸ªç©ºæ•°ç»„
                    var rows = []
                        //éå†æ•°ç»„é‡Œçš„æ•°æ®  æœåŠ¡å™¨å“åº”å›æ¥çš„æ•°æ®ä¸­çš„res.data
                    $.each(res.data, function(i, item) {
                            rows.push('<tr><td>' + item.id + '</td><td>' + item.bookname + '</td><td>' + item.author + '</td><td>' + item.publisher + '</td><td><a href="javascript:;" class="del" data-id = "' + item.id + '">åˆ é™¤</a></td></tr>')
                        })
                        //æ¯å¾ªç¯ä¸€æ¬¡å¾€#tbé‡Œè¿½åŠ trï¼Œå…ˆæŠŠé‡Œè¾¹çš„å†…å®¹æ¸…ç©ºempty() è¿½åŠ appendç©ºçš„å­—ç¬¦ä¸²(æ•°ç»„.join('')) 
                    $('#tb').empty().append(rows.join(''))
                })
            }
            getBookList()


            //ğŸ˜‰ä¸ºdelç»‘å®šå•å‡»äº‹ä»¶ ç‚¹å‡»åˆ é™¤æŒ‰é’® æ˜¾ç¤ºå¯¹åº”çš„idå·ç 
            //å› ä¸ºåˆ é™¤æŒ‰é’®ä¸€å¼€å§‹æ²¡æœ‰ æ˜¯åŠ¨æ€ç”Ÿæˆçš„ï¼Œæ‰€ä»¥å…ˆç»‘å®šçˆ¶å…ƒç´ #tbï¼Œå†é€šè¿‡ä»£ç†çš„æ–¹å¼æ·»åŠ 
            $('#tb').on('click', '.del', function() {
                //åˆ é™¤çš„è¯å¯è·å–è¿™ä¸€è¡Œå›¾ä¹¦çš„idï¼Œä»¥å†…idå·æ˜¯ç‹¬ä¸€æ— äºŒçš„ attr()è·å–è‡ªå®šä¹‰çš„id
                var id = $(this).attr('data-id')
                    //ğŸ˜‰åˆ é™¤å›¾ä¹¦çš„åŠŸèƒ½
                $.get('http://www.liulongbin.top:3006/api/delbook', {
                    id: id
                }, function(res) {
                    if (res.status !== 200) {
                        return alert('åˆ é™¤å›¾ä¹¦å¤±è´¥äº†å‘¢')
                            //æˆåŠŸäº†éœ€è¦åˆ·æ–°ä¸€ä¸‹åˆ—è¡¨ï¼Œè°ƒç”¨å‡½æ•°å°±ok
                        getBookList()
                    }
                })
            })

            //ğŸ˜Šä¸ºbtnAddç»‘å®šæ·»åŠ äº‹ä»¶å¤„ç†å‡½æ•°ï¼Œè·å–åˆ°ç”¨æˆ·è¾“å…¥çš„å€¼
            $('#btnAdd').on('click', function() {
                //è·å–ä¸‰ä¸ªæ–‡æœ¬æ¡†çš„å€¼val()
                var bookname = $('#iptBookname').val().trim()
                var author = $('#iptAuthor').val().trim()
                var publisher = $('#iptPublisher').val().trim()

                //è¿›è¡Œéæ³•å€¼çš„æ ¡éªŒ
                if (bookname.length <= 0 || author.length <= 0 || publisher.length <= 0) {
                    return alert('è¾“å…¥çš„å€¼æœ‰è¯¯')
                }


                //ğŸ˜Šæ·»åŠ å›¾ä¹¦åŠŸèƒ½
                $.post('http://www.liulongbin.top:3006/api/addbook', {
                    bookname: bookname,
                    author: author,
                    publisher: publisher
                }, function(res) {
                    if (res.status !== 201) return alert('æ·»åŠ å›¾ä¹¦å¤±è´¥ï¼')
                        //é‡æ–°è·å–å›¾ä¹¦åˆ—è¡¨
                    getBookList()
                        //æŠŠåˆšæ‰ç”¨æˆ·è¾“å…¥çš„å¤åŸ 
                    $('#iptBookname').val('')
                    $('#iptAuthor').val('')
                    $('#iptPublisher').val('')
                })
            })
        })
    </script>


</body>

</html>