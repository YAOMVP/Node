<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Document</title>
    <link rel="stylesheet" href="./assets/news.css" />

</head>

<body>
    <div id="news-list">

    </div>

    <!-- æ¨¡æ¿ -->

    <!-- <div class="news-item">
        <img class="thumb" src="" alt="" />
        <div class="right-box">
            <h1 class="title"></h1>
            <div class="tags">
                <span></span>
            </div>
            <div class="footer">
                <div>
                    <span></span>&nbsp;&nbsp;
                    <span></span>
                </div>
                <span>è¯„è®ºæ•°ï¼š</span>
            </div>
        </div>
    </div> -->

</body>

</html>
<script src="./lib/jquery.js"></script>
<script src="./news.js"></script>
<script src="./lib/template-web.js"></script>
<!-- å‡†å¤‡æ¨¡æ¿ç»“æ„ -->
<script type="text/html" id="tpl-news">
    {{each}}
    <div class="news-item">
        <img class="thumb" src="http://www.liulongbin.top:3006{{$value.img}}" alt="" />
        <div class="right-box">
            <h1 class="title">{{$value.title}}</h1>
            <div class="tags">
                {{each $value.tags}}
                <span>{{$value}}</span> {{/each}}
            </div>
            <div class="footer">
                <div>
                    <span>{{$value.source}}</span>&nbsp;&nbsp;
                    <span>{{$value.time|getTime}}</span>
                </div>
                <span>è¯„è®ºæ•°ï¼š{{$value.cmtcount}}</span>
            </div>
        </div>
    </div>
    {{/each}}
</script>


<script>
    $(function() {
        // 2. å‡†å¤‡è¿‡æ»¤å‡½æ•°
        // template.defaults.imports.å‡½æ•°å = function (){}
        template.defaults.imports.getTime = function(date) {
                // å‡½æ•°ä½“ä»£ç : å¯¹åŸå§‹æ•°æ®å¦‚ä½•å¤„ç†
                // é—®é¢˜: åå°è¿”å›çš„æ˜¯ä¸€ä¸ªæ—¶é—´å­—ç¬¦ä¸²,æ— æ³•è°ƒç”¨æ—¶é—´å¯¹è±¡çš„æ–¹æ³•
                // ğŸ˜ŠğŸ˜ŠğŸ˜ŠğŸ˜ŠğŸ˜Šè§£å†³: å°†æ—¶é—´å­—ç¬¦ä¸²å˜æˆæ—¶é—´å¯¹è±¡
                // new Date(): å½“å‰æ—¶é—´å¯¹è±¡
                // new Date('æ—¶é—´å­—ç¬¦ä¸²'): æŒ‡å®šæ—¶é—´å¯¹è±¡
                date = new Date(date);

                let year = date.getFullYear();
                let month = date.getMonth() + 1;
                month = month < 10 ? "0" + month : month;
                let day = date.getDate();
                day = day < 10 ? "0" + day : day;
                let hour = date.getHours();
                hour = hour < 10 ? "0" + hour : hour;
                let min = date.getMinutes();
                min = min < 10 ? "0" + min : min;
                let sec = date.getSeconds();
                sec = sec < 10 ? "0" + sec : sec;

                // è¿”å›æ•°æ®
                return `${year}-${month}-${day} ${hour}:${min}:${sec}`;
            }
            //1.ğŸ˜Šå‘èµ·ajaxè¯·æ±‚ï¼Œè·å¾—æ•°æ®
        $.ajax({
            type: "get",
            url: "http://www.liulongbin.top:3006/api/news",
            success: function(backData) {
                console.log(backData);
                if (backData.status === 200) {
                    let dataArr = backData.data;
                    console.log(dataArr);
                    //2.ğŸ˜Šå…¶ä¸­tagsæ˜¯è¿åœ¨ä¸€èµ·çš„å­—ç¬¦ä¸²æ ¼å¼ï¼Œè¿åœ¨ä¸€èµ·äº†ï¼ï¼ï¼å¦‚ä½•å˜æˆåˆ†å¼€çš„æ ‡ç­¾å½¢å¼å‘¢ï¼Ÿï¼Ÿï¼Ÿ åå°ä¸æ˜¯åˆ†å¼€çš„å­—ç¬¦ä¸²ï¼Œéœ€è¦è½¬æˆæ•°ç»„ï¼Œå°±æ˜¯å•ç‹¬çš„å­—ç¬¦ä¸²äº†

                    //3.ğŸ˜Š,åˆ†éš”æ–¹æ³•split() ->åˆ†å‰²å­—ç¬¦ä¸²å˜æˆæ•°ç»„
                    $.each(dataArr, function(index, value) {
                        //ğŸ˜Šæ‹†æˆäº†æ•°ç»„ï¼Œè¦å­˜å›tagsğŸ˜ŠğŸ˜ŠğŸ˜ŠğŸ˜ŠğŸ˜ŠæŠŠè‡ªå·±æ”¹æ‰ï¼Œå†èµ‹å€¼è‡ªå·±
                        value.tags = value.tags.split(",");
                        console.log(dataArr);
                    })
                    let htmlStr = template("tpl-news", dataArr);
                    $("#news-list").html(htmlStr);
                }
            }
        })
    })
</script>