<!DOCTYPE html>
<html lang="zh-cn">

<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Bootstrap 101 Template</title>

    <!-- Bootstrap -->
    <link href="./lib/bootstrap/css/bootstrap.min.css" rel="stylesheet" />

    <!--
      HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries
    -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="http://cdn.bootcss.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="http://cdn.bootcss.com/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
    <style>
        .wrap {
            position: fixed;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: url('images/bg03.jpg') center bottom no-repeat;
            overflow: auto;
        }
        
        .navbar-brand {
            padding: 10px 15px;
        }
        
        .page-title {
            font-size: 16px;
            font-weight: bold;
        }
        
        .file-input {
            outline: none;
            display: inline-block;
            margin-top: 5px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-horizontal {
            margin-top: 10px;
        }
        
        .logout {
            font-weight: 900;
            font-size: 20px;
            color: #ff0000;
            text-decoration: none;
        }
        
        .logout:hover {
            text-decoration: none;
            color: yellowgreen;
        }
        
        .preview {
            width: 100px;
            height: 100px;
        }
    </style>
</head>

<body>
    <div class="wrap">
        <nav class="navbar  navbar-inverse navbar-static-top">
            <div class="container">
                <div class="navbar-header">
                    <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#mymenu">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
                    <a class="navbar-brand" href="#"><img src="images/logo.png"></a>
                </div>
            </div>
        </nav>

        <div class="container">
            <div class="row">
                <div class="col-md-12">
                    <div class="panel panel-default">
                        <div class="panel-heading clearfix">
                            <div class="row">
                                <div class="col-md-6 page-title">æ–°å¢è‹±é›„</div>
                                <div class="col-md-6 text-right">å½“å‰ä½ç½®ï¼šé¦–é¡µ &gt; æ–°å¢è‹±é›„</div>
                            </div>
                        </div>
                        <div class="panel-body">
                            <form action="#" method="" class="form-horizontal">
                                <div class="form-group">
                                    <label for="heroName" class="col-sm-2 control-label">å§“å</label>
                                    <div class="col-sm-10">
                                        <input type="text" class="form-control" id="heroName" name="name" placeholder="è¯·è¾“å…¥å§“å" />
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="skillName" class="col-sm-2 control-label">æŠ€èƒ½</label>
                                    <div class="col-sm-10">
                                        <input type="text" class="form-control" id="skillName" name="skill" placeholder="è¯·è¾“å…¥æŠ€èƒ½" />
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="heroIcon" class="col-sm-2 control-label">å¤´åƒ</label>
                                    <div class="col-sm-10">
                                        <input type="file" class="file-input" id="heroIcon" name="icon" />
                                        <img src="" class="preview" alt="" />
                                    </div>
                                </div>
                                <div class="form-group">
                                    <div class="col-sm-offset-2 col-sm-10">
                                        <button type="submit" class="btn btn-success btn-add">
                      æ–° å¢
                    </button>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script src="./lib/bootstrap/js/jquery-1.12.4.js"></script>
    <script src="./lib/bootstrap/js/bootstrap.min.js"></script>

</body>

</html>
<script>
    // $(function () {
    //   // 1. å®Œæˆå›¾ç‰‡çš„é¢„è§ˆåŠŸèƒ½
    //   // ç›‘å¬ä¸Šä¼ æŒ‰é’®æ˜¯å¦å‘ç”Ÿå˜åŒ–
    //   // è·å¾—å½“å‰ä¸Šä¼ å›¾ç‰‡çš„æ–‡ä»¶
    //   // å°†æ–‡ä»¶å˜æˆè·¯å¾„,å°†è·¯å¾„èµ‹å€¼ç»™imgæ ‡ç­¾
    //   $('#heroIcon').on('change',function(e){
    //     // 2. è·å¾—å½“å‰ä¸Šä¼ çš„å›¾ç‰‡æ–‡ä»¶å¯¹è±¡
    //     let picFile = this.files[0];

    //     // 3. å°†å›¾ç‰‡å¯¹è±¡è½¬æ¢æˆä¸ºå›¾ç‰‡è·¯å¾„
    //     let picUrl = URL.createObjectURL(picFile);
    //     // console.log(picUrl);

    //     // 4. å°†å›¾ç‰‡çš„è·¯å¾„èµ‹å€¼ç»™imgæ ‡ç­¾
    //     $('img.preview').attr('src', picUrl);
    //   })

    //   // 5. ç»™æ–°å¢æŒ‰é’®è®¾ç½®ç‚¹å‡»äº‹ä»¶
    //   $('.btn-add').on('click',function(e){
    //     e.preventDefault();

    //     // 6. è·å¾—è¡¨å•åŸŸä¸­æ‰€æœ‰çš„æ•°æ®: åç§°,æŠ€èƒ½,å¤´åƒ
    //     // å°è¯•ä½¿ç”¨å¿«é€Ÿåºåˆ—åŒ–è·å¾—æ•°æ®
    //     // æ³¨æ„: åªèƒ½è·å¾—æ–‡å­—æ•°æ®,æ— æ³•è·å¾—å›¾ç‰‡æ•°æ®
    //     // let data = $('form').serialize();

    //     // 7. åˆ©ç”¨FormDataæ–¹å¼è·å¾—è¡¨å•åŸŸä¸­æ‰€æœ‰æ•°æ®: æ–‡å­—å’Œå›¾ç‰‡
    //     // new FormData(åŸç”Ÿçš„formæ ‡ç­¾)
    //     // å‰æ: è¡¨å•æ§ä»¶çš„nameå€¼ä¸å‚æ•°åä¸€æ ·
    //     let fd = new FormData(document.querySelector('form'));
    //     // console.log(fd);// æ— æ³•ç›´æ¥æ‰“å°è·å–

    //     // åˆ©ç”¨fd.get('å‚æ•°å')è·å–
    //     // console.log(fd.get('name'));
    //     // console.log(fd.get('skill'));
    //     // console.log(fd.get('icon'));

    //     // 8. å‘èµ·ajaxè¯·æ±‚,æºå¸¦formDataæ•°æ®æäº¤
    //     // formDataçš„ajaxè¯·æ±‚æœ‰ä¸åŒçš„åœ°æ–¹
    //     $.ajax({
    //       type: 'post',
    //       url: 'http://localhost:4399/hero/add',
    //       data: fd,
    //       // FormDataæ˜¯ä¸€ç§åŠ å¯†æ–¹å¼,postè¯·æ±‚é»˜è®¤ä¹Ÿæœ‰ä¸€ç§åŠ å¯†æ–¹å¼: application/x-www-form-urlencoded
    //       // ä¸¤ç§åŠ å¯†æ–¹å¼ä¼šå†²çª,éœ€è¦å°†é»˜è®¤çš„postè¯·æ±‚åŠ å¯†å…³é—­
    //       contentType: false,
    //       processData: false,
    //       success: function(backData) {
    //         // console.log(backData);
    //         if (backData.code == 201) {
    //           alert(backData.msg);
    //           window.location = './index.html';
    //         }
    //       }
    //     })

    //   })
    // })

    $(function() {
        // ğŸ˜Š1.å®Œæˆå›¾ç‰‡çš„é¢„è§ˆåŠŸèƒ½
        //ğŸ˜ŠğŸ˜ŠğŸ˜Šè¦çŸ¥é“æŒ‰é’®æ˜¯å¦æœ‰å˜åŒ– éœ€è¦ç”¨åˆ°change ä¸æ˜¯click
        //ğŸ“—clickæ˜¯ç‚¹å‡»å°±è§¦å‘  changeæ˜¯æ”¹å˜äº†æ‰è§¦å‘
        $("#heroIcon").on("change", function() { //ğŸ“—ä¸æ˜¯ç‚¹å‡»äº†å°±è§¦å‘ï¼Œæ˜¯change
            // console.log("è§¦å‘äº†");
            //2.æ–°ğŸ˜Šè·å¾—å½“å‰ä¸Šä¼ çš„æ–‡ä»¶å¯¹è±¡  

            //console.log(this.files);
            let picFile = this.files[0]; //thisæŒ‡çš„$("#heroIcon")é‡Œè¾¹æœ‰ä¸ªfileså±æ€§,é‡Œè¾¹çš„ç¬¬0å¼ ç…§ç‰‡ 
            //ğŸ˜Šæ˜¯ä¸ªä»¥å¯¹è±¡{}å½¢å¼å­˜å‚¨çš„ä¼ªæ•°ç»„ï¼Œå› ä¸ºindexæ˜¯0 è¿˜æœ‰length

            //3.æ–°ğŸ˜ŠğŸ˜ŠğŸ˜ŠğŸ˜ŠğŸ˜Šå°†å›¾ç‰‡å¯¹è±¡ è½¬æ¢ä¸ºå›¾ç‰‡è·¯å¾„
            let picUrl = URL.createObjectURL(picFile);
            console.log(picUrl);
            //4.ğŸ˜Šå°†å›¾ç‰‡çš„è·¯å¾„èµ‹å€¼ç»™imgæ ‡ç­¾
            $("img.preview").attr("src", picUrl);
        })

        //5.ğŸ˜Šç‚¹å‡»æ–°å¢æŒ‰é’®ï¼Œå¯ä»¥æ·»åŠ æ•°æ®ï¼Œæ–°å¢æŒ‰é’®åœ¨formè¡¨å•é‡Œï¼Œåˆ«å¿˜äº†é˜»æ­¢é»˜è®¤è¡Œä¸ºï¼Œè¦ä¸ç„¶ä¼šæœ‰è‡ªåŠ¨åˆ·æ–°åŠŸèƒ½
        $(".btn-add").on("click", function(e) {
            e.preventDefault();
            //ğŸ˜ŠğŸ˜ŠğŸ˜ŠğŸ˜ŠğŸ˜ŠğŸ˜ŠğŸ˜ŠğŸ˜ŠğŸ˜ŠğŸ˜ŠğŸ˜ŠğŸ˜Š5.1 è·å¾—è¡¨å•åŸŸä¸­name skill iconå‚æ•° å¯ç”¨serialize()æ–¹æ³• ä¹Ÿå«å¿«é€Ÿåºåˆ—åŒ–æ–¹æ³• ä¸€èµ·å¾—åˆ°å—ï¼Ÿåªèƒ½å¾—åˆ°å­—ç¬¦ä¸² iconå›¾ç‰‡å¾—ä¸åˆ°
            // let data = (".form").serialize(); //æ³¨æ„ é‡Œè¾¹çš„åå­—ä¸classåå­—æ˜¯å¦åŒ¹é…

            //5.2æ–°ğŸ˜Šå­—ç¬¦ä¸²+å›¾ç‰‡å¯ä»¥ç”¨formDataæ¥è·å–  
            //5.2æ–°ğŸ˜Š new formData()  æ„é€ å‡½æ•°ï¼ï¼ï¼ï¼ï¼
            //5.2æ–°ğŸ˜Š (åŸç”Ÿjsçš„æ–¹å¼è·å–è¡¨å•)
            let fd = new FormData(document.querySelector("form"));
            //5.2æ–°ğŸ˜Š è¿™æ—¶å€™ä¼šæŠŠè¡¨å•æ‰€æœ‰çš„æ•°æ®éƒ½æ”¾åœ¨fdé‡Œï¼Œ
            //5.2æ–°ğŸ˜Šconsole.log(fd);  formDataæœ¬èº«æ˜¯ä¸€ç§åŠ å¯†æ–¹å¼ï¼Œæ— æ³•ç›´æ¥æ‰“å°è·å–
            //5.2æ–°ğŸ˜Š æˆ‘ä»¬å¯ä»¥åˆ†åˆ«æŸ¥çœ‹ åˆ©ç”¨fd.get("å‚æ•°å");  å­˜è¿›å»å“ªäº› å»çš„æ—¶å€™å°±è¦è¿™è¦æŸ¥çœ‹
            console.log(fd.get("name"));
            console.log(fd.get("skill"));
            console.log(fd.get("icon"));

            //5.3ğŸ˜Šå‘èµ·ajaxè¯·æ±‚
            $.ajax({
                type: "post",
                url: "http://localhost:4399/hero/add",
                //5.4æ–°ğŸ˜Šdataé‡Œç›´æ¥è·Ÿä¸Šfd å› ä¸ºdataé‡Œè¦{å¯¹è±¡} fdå°±æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå› ä¸ºnew äº†FormData
                data: fd,
                //5.4æ–°ğŸ˜Š FormDataæ˜¯ä¸€ç§åŠ å¯†æ–¹å¼ï¼Œpostè¯·æ±‚ä¹Ÿæ˜¯ä¸€ç§åŠ å¯†æ–¹å¼ï¼Œæ‰€ä»¥éœ€è¦å…³é—­é»˜è®¤çš„poståŠ å¯†æ–¹å¼ application/x-wwww-form-urlencoded  é‡Œè¾¹çš„ä¹Ÿå°±æ˜¯è¯·æ±‚å¤´çš„å‰è¾¹
                contentType: false,
                processData: false,
                //5.4æ–°ğŸ˜Šè¿™è¦å°±åªå‰©ä¸‹FormDataçš„è‡ªå·±åŠ å¯†æ–¹å¼äº†
                success: function(backData) {
                    console.log(backData);
                    if (backData.code === 201) {
                        $(".modal-body p").html("backData.msg");
                        $('#myModal').modal() //ğŸ“—è°ƒç”¨æ¨¡æ€æ¡†ï¼Œå»é¡µé¢ä¸Šæ‰¾â€œç”¨æ³•â€  vscodeä»£ç ä¸Šè¾¹æ²¡æœ‰idè¦åŠ ä¸Š
                        window.location = "./index.html";
                    }
                }
            })
        })
    })
</script>