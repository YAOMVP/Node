<!DOCTYPE html>
<html lang="zh-cn">

<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Bootstrap 101 Template</title>

    <!-- Bootstrap -->
    <link href="./lib/bootstrap/css/bootstrap.min.css" rel="stylesheet" />

    <!--
      HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries
    -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="http://cdn.bootcss.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="http://cdn.bootcss.com/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
    <style>
        .wrap {
            position: fixed;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: url('images/bg03.jpg') center bottom no-repeat;
            overflow: auto;
        }
        
        .navbar-brand {
            padding: 10px 15px;
        }
        
        .page-title {
            font-size: 16px;
            font-weight: bold;
        }
        
        .file-input {
            outline: none;
            display: inline-block;
            margin-top: 5px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-horizontal {
            margin-top: 10px;
        }
        
        .logout {
            font-weight: 900;
            font-size: 20px;
            color: #ff0000;
            text-decoration: none;
        }
        
        .logout:hover {
            text-decoration: none;
            color: yellowgreen;
        }
        
        .preview {
            width: 100px;
            height: 100px;
        }
    </style>
</head>

<body>
    <div class="wrap">
        <nav class="navbar  navbar-inverse navbar-static-top">
            <div class="container">
                <div class="navbar-header">
                    <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#mymenu">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
                    <a class="navbar-brand" href="#"><img src="images/logo.png"></a>
                </div>
            </div>
        </nav>


        <div class="container">
            <div class="row">
                <div class="col-md-12">
                    <div class="panel panel-default">
                        <div class="panel-heading clearfix">
                            <div class="row">
                                <div class="col-md-6 page-title">è‹±é›„ä¿¡æ¯ä¿®æ”¹</div>
                                <div class="col-md-6 text-right">å½“å‰ä½ç½®ï¼šé¦–é¡µ &gt; è‹±é›„ä¿¡æ¯ä¿®æ”¹</div>
                            </div>
                        </div>
                        <div class="panel-body">
                            <form action="#" method="" class="form-horizontal">
                                <!-- éšè—ä¸€ä¸ªinput  éšè—åŸŸ:å¤©ç”Ÿå°±æ˜¯éšè—çš„-->
                                <!-- <input type="hidden" name="id" id="heroId"/> -->

                                <div class="form-group">
                                    <label for="heroName" class="col-sm-2 control-label">å§“å</label>
                                    <div class="col-sm-10">
                                        <input required type="text" class="form-control" id="heroName" name="name" placeholder="è¯·è¾“å…¥å§“å" value="ç›–ä¼¦" />
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="skillName" class="col-sm-2 control-label">æŠ€èƒ½</label>
                                    <div class="col-sm-10">
                                        <input required type="text" class="form-control" id="skillName" name="skill" placeholder="è¯·è¾“å…¥æŠ€èƒ½" value="èº²è‰ä¸›" />
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="heroIcon" class="col-sm-2 control-label">å¤´åƒ</label>
                                    <div class="col-sm-10">
                                        <!-- é¢„è§ˆçš„æ ‡ç­¾ -->
                                        <img src="lib/img/ç›–ä¼¦.png" class="preview" alt="">
                                        <input required type="file" class="file-input" id="heroIcon" name="icon" />
                                    </div>
                                </div>
                                <div class="form-group">
                                    <div class="col-sm-offset-2 col-sm-10">
                                        <button type="submit" class="btn btn-primary btn-save">
                      ä¿å­˜
                    </button>
                                        <button type="submit" class="btn btn-cancel">å–æ¶ˆ</button>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script src="./lib/bootstrap/js/jquery-1.12.4.js"></script>
    <script src="./lib/bootstrap/js/bootstrap.min.js"></script>

</body>

</html>
<script>
    $(function() {
        // 1. è·å¾—æŒ‡å®šçš„è‹±é›„id(åœ¨urlè·¯å¾„çš„æœ«ç«¯)
        // window.location.search --> å¯ä»¥ç›´æ¥è·å¾—urlçš„å‚æ•°éƒ¨åˆ†
        let heroid = window.location.search.split('=')[1];

        // 2. æ ¹æ®è‹±é›„çš„idå‘èµ·ajaxè¯·æ±‚
        $.ajax({
            type: 'get',
            url: 'http://localhost:4399/hero/id',
            data: {
                id: heroid
            },
            success: function(backData) {
                // console.log(backData);
                if (backData.code == 200) {
                    // 3. å°†æ•°æ®èµ‹å€¼åˆ°æŒ‡å®šçš„å®¹å™¨ä¸­
                    $('#heroName').val(backData.data.name);
                    $('#skillName').val(backData.data.skill);
                    $('img.preview').attr('src', backData.data.icon);
                }
            }
        })

        // 4. å®Œæˆå›¾ç‰‡é¢„è§ˆ
        $('#heroIcon').on('change', function(e) {
            let picFile = this.files[0]; //ğŸ˜Šæ‹¿åˆ°ç¬¬0å¼ å›¾ç‰‡
            let picUrl = URL.createObjectURL(picFile); //ğŸ˜Šæ‹¿åˆ°å›¾ç‰‡è·¯å¾„
            $('img.preview').attr('src', picUrl); //ğŸ˜Šå†æŠŠè·¯å¾„èµ‹å€¼ç»™å›¾ç‰‡
        })

        // 7. ç»™ä¿å­˜æŒ‰é’®è®¾ç½®ç‚¹å‡»äº‹ä»¶
        $('.btn-save').on('click', function(e) {
            e.preventDefault();

            // 6. è·å¾—å½“å‰è‹±é›„çš„æ•°æ®(åˆ©ç”¨FormDataè·å–)
            let fd = new FormData(document.querySelector('form')); // è‡ªåŠ¨è·å¾—name,skill,icon

            // 7. æ‰‹åŠ¨æ·»åŠ è‹±é›„id  è¿™æ˜¯ä¸ªæ–¹æ³• ä¸å’Œä¹‹å‰appendçš„ä¸€æ ·
            fd.append('id', heroid);

            // console.log(fd.get('name'));
            // console.log(fd.get('skill'));
            // console.log(fd.get('id'));
            // console.log(fd.get('icon'));

            // 8. å‘èµ·ajaxè¯·æ±‚,æºå¸¦FormDataæ•°æ®
            $.ajax({
                type: 'post',
                url: 'http://localhost:4399/hero/update',
                data: fd,
                contentType: false,
                processData: false,
                success: function(backData) {
                    // console.log(backData);
                    if (backData.code == 202) {
                        alert(backData.msg);
                        window.location.href = './index.html';
                    }
                }
            })

        })

    })
    $(function() {
        //åˆå§‹åšæ³•æ‹¿åˆ°è‹±é›„çš„è·¯å¾„
        let url = window.location.href;
        console.log(url);
        //è¦çš„æ˜¯ï¼Ÿåè¾¹
        let search0 = url.split("?")[1];
        let heroid0 = search0.split("=")[1];
        console.log(heroid0);

        //ğŸ˜ŠğŸ˜ŠğŸ˜Šæœ€ç»ˆåšæ³•ï¼šè·å¾—æŒ‡å®šçš„è‹±é›„id
        let heroid = window.location.search.split("=")[1]; //ç›´æ¥å°±å¯ä»¥æ‹¿åˆ°ï¼Ÿåè¾¹çš„å€¼ ä½†æ˜¯åªè¦=åè¾¹çš„è¿˜éœ€è¦æ‹¼æ¥
        console.log(heroid); //81 æ‹¿åˆ°çš„æ˜¯å€¼


        //ğŸ˜Šæ ¹æ®idè·å–è‹±é›„ å‘èµ·ajaxè¯·æ±‚

    })
</script>